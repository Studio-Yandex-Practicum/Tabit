# Уровни доступа

## Роли

1. Tabit Superuser (TS)
- Все права администратора сервиса
- Эксклюзивные права:
  - Создание/удаление администраторов сервиса
  - Просмотр списка всех администраторов
  - Управление правами администраторов
  - Доступ к системным настройкам

2. Tabit Admin (TA)
- Управление компаниями:
  - CRUD операции с компаниями
  - Просмотр информации о всех компаниях
- Управление лицензиями:
  - CRUD операции с типами лицензий
  - Назначение лицензий компаниям
- Управление сотрудниками компаний:
  - Просмотр списка всех сотрудников
  - Управление учетными записями сотрудников
- Управление опросами:
  - Создание/редактирование шаблонов опросов (вопрос обсуждается)
  - Просмотр результатов опросов всех компаний
- Нет доступа к:
  - Управлению другими администраторами
  - Системным настройкам

3. Company Moderator (CM)
- Управление структурой компании:
  - CRUD операции с отделами
  - Управление сотрудниками своей компании
  - Импорт/экспорт списка сотрудников
- Управление проблемами:
  - CRUD операции с проблемами
  - Назначение ответственных
  - Управление статусами задач
  - Создание и модерация тредов обсуждений
- Управление встречами:
  - CRUD операции со встречами
  - Назначение участников
  - Управление расписанием
- Управление опросами:
  - Запуск опросов для сотрудников
  - Просмотр результатов опросов своей компании
  - Доступ к аналитике и динамике результатов

4. Company User (CU)
- Базовый функционал:
  - Просмотр и выполнение назначенных задач
  - Участие в опросах
  - Обновление статуса своих задач
  - Участие в обсуждениях проблем
  - Просмотр встреч, в которых участвует
- Личный кабинет:
  - Редактирование личного профиля
  - Просмотр своей истории опросов
  - Управление уведомлениями
  - Отправка обратной связи
- Ограничения:
  - Нет доступа к управлению другими пользователями
  - Нет доступа к административным функциям
  - Нет доступа к общей аналитике

## Таблицы прав доступа

### Файл `src/api/v1/endpoints/company.py`
Prefix: `/{company_slug}`
| Эндпоинт                     | Метод | TS | TA | CM | CU | Описание                            |
|------------------------------|:-----:|:--:|:--:|:--:|:--:|-------------------------------------|
| /                            | GET   | +  | +  | +  | -  | Получить информацию о компании      |
| /departments                 | GET   | +  | +  | +  | -  | Получить отделы компании            |
| /departments                 | POST  | +  | +  | +  | -  | Создать отдел компании              |
| /departments/import          | POST  | +  | +  | +  | -  | Импорт отделов                      |
| /department/{department_id}  | GET   | +  | +  | +  | -  | Получить информацию об отделе       |
| /department/{department_id}  | PATCH | +  | +  | +  | -  | Обновить отдел компании             |
| /department/{department_id}  | DELETE| +  | +  | +  | -  | Удалить отдел компании              |
| /employees                   | GET   | +  | +  | +  | -  | Получить список сотрудников         |
| /employees                   | POST  | +  | +  | +  | -  | Добавить сотрудника                 |
| /employees/import            | POST  | +  | +  | +  | -  | Импорт сотрудников                  |
| /employees/{uuid}            | GET   | +  | +  | +  | -  | Получить информацию о сотруднике    |
| /employees/{uuid}            | PATCH | +  | +  | +  | -  | Изменить данные сотрудника          |
| /employees/{uuid}            | DELETE| +  | +  | +  | -  | Удалить сотрудника                  |

### Файл `src/api/v1/endpoints/company_user.py`
Prefix: -
| Эндпоинт                     | Метод | TS | TA | CM | CU | Описание                            |
|------------------------------|:-----:|:--:|:--:|:--:|:--:|-------------------------------------|
| /company_id/{uuid}/          | GET   | +  | +  | +  | +  | Личный кабинет пользователя         |
| /company_id/{uuid}/          | PATCH | +  | +  | +  | +  | Редактирование профиля              |
| /{company_slug}/feedback/    | POST  | +  | +  | +  | +  | Отправить обратную связь            |

### Файл `src/api/v1/endpoints/company_user_auth.py`
Prefix: `/auth`
| Эндпоинт               | Метод | TS | TA | CM | CU | Описание                                  |
|------------------------|:-----:|:--:|:--:|:--:|:--:|-------------------------------------------|
| /login                 | POST  | -  | -  | +  | +  | Авторизация пользователя                  |
| /logout                | POST  | -  | -  | +  | +  | Выход из системы                          |
| /refresh-token         | POST  | -  | -  | +  | +  | Обновление токена                         |
| /forgot-password       | POST  | -  | -  | +  | +  | Запрос на сброс пароля                    |
| /reset-password        | POST  | -  | -  | +  | +  | Сброс пароля пользователя                 |

### Файл `src/api/v1/endpoints/problems.py`
Prefix: `{company_slug}/problems`
| Эндпоинт               | Метод | TS | TA | CM | CU | Описание                                  |
|------------------------|:-----:|:--:|:--:|:--:|:--:|-------------------------------------------|
| /                      | GET   | +  | +  | +  | +  | Получить список всех проблем              |
| /                      | POST  | +  | +  | +  | -  | Создать новую проблему                    |
| /{problem_id}          | GET   | +  | +  | +  | +  | Получить информацию о проблеме            |
| /{problem_id}          | PATCH | +  | +  | +  | -  | Обновить информацию о проблеме            |
| /{problem_id}          | DELETE| +  | +  | +  | -  | Удалить проблему                          |

### Файл `src/api/v1/endpoints/problem_feeds.py`
Prefix: `{company_slug}/problems/{problem_id}`
| Эндпоинт                             | Метод | TS | TA | CM | CU | Описание                    |
|--------------------------------------|:-----:|:--:|:--:|:--:|:--:|-----------------------------|
| /thread                              | GET   | +  | +  | +  | +  | Получить список всех тредов |
| /thread                              | POST  | +  | +  | +  | -  | Создать тред по проблеме    |
| /{thread_id}/comments                | POST  | +  | +  | +  | +  | Создать комментарий в треде |
| /{thread_id}/comments/{comment_id}   | PATCH | +  | +  | +  | +  | Обновить комментарий в треде|
| /{thread_id}/comments/{comment_id}   | DELETE| +  | +  | +  | +  | Удалить комментарий в треде |
| /{thread_id}/comments/{comment_id}/like |POST| +  | +  | +  | +  | Поставить лайк комментарию  |

### Файл `src/api/v1/endpoints/problem_meetings.py`
Prefix: `{company_slug}/problems/{problem_id}/meetings`
| Эндпоинт               | Метод | TS | TA | CM | CU | Описание                                  |
|------------------------|:-----:|:--:|:--:|:--:|:--:|-------------------------------------------|
| /                      | GET   | +  | +  | +  | +  | Получить список всех встреч               |
| /                      | POST  | +  | +  | +  | -  | Создать встречу                           |
| /{meeting_id}          | GET   | +  | +  | +  | +  | Получить информацию о встрече             |
| /{meeting_id}          | PATCH | +  | +  | +  | -  | Обновить информацию о встрече             |
| /{meeting_id}          | DELETE| +  | +  | +  | -  | Удалить встречу                           |

### Файл `src/api/v1/endpoints/surveys.py`
Prefix: `{company_slug}/surveys`
| Эндпоинт               | Метод  | TS | TA | CM | CU | Описание                                 |
|------------------------|:------:|:--:|:--:|:--:|:--:|------------------------------------------|
| /                      | GET    | +  | +  | +  | +  | Получить список всех опросов             |
| /                      | POST   | +  | +  | +  | -  | Создать новый опрос                      |
| /{uuid}                | GET    | +  | +  | +  | +  | Получить историю опросов сотрудника      |
| /{uuid}/{survey_id}    | GET    | +  | +  | +  | +  | Получить информацию об опросе            |
| /results/general       | GET    | +  | +  | +  | +  | Получить общий результат опросов         |
| /results/personalized  | GET    | +  | +  | +  | +  | Получить персонализированный результат   |
| /results/dynamics      | GET    | +  | +  | +  | +  | Получить динамику результатов            |
| /manage                | POST   | +  | +  | +  | -  | Управление опросами компании             |
| /manage                | DELETE | +  | +  | +  | -  | Удалить опросы компании                  |

### Файл `src/api/v1/endpoints/tabit_management.py`
Prefix: `/admin`
| Эндпоинт                       | Метод  | TS | TA | CM | CU | Описание                                             |
|--------------------------------|:------:|:--:|:--:|:--:|:--:|------------------------------------------------------|
| /                              | GET    | +  | +  | -  | -  | Получить общую информацию по<br> по компаниям        |
| /staff                         | GET    | +  | +  | -  | -  | Получить информацию по всем<br> сотрудникам компаний |
| /staff                         | POST   | +  | +  | -  | -  | Создать нового сотрудника<br> компании               |
| /staff/{user_id}               | GET    | +  | +  | -  | -  | Получить информацию об<br> администраторе            |
| /staff/{user_id}               | PUT    | +  | +  | -  | -  | Полностью изменить информацию<br> об администраторе  |
| /staff/{user_id}               | PATCH  | +  | +  | -  | -  | Частично изменить информацию<br> об администраторе   |
| /staff/{user_id}               | DELETE | +  | +  | -  | -  | Удалить информацию о<br> администраторе              |
| /staff/{user_id}/resetpassword | POST   | +  | +  | -  | -  | Сброс пароля администратора<br> администратора       |

### Файл `src/api/v1/endpoints/tabit_management_licenses.py`
Prefix: `/admin/licenses`
| Эндпоинт               | Метод  | TS | TA | CM | CU | Описание                                 |
|------------------------|:------:|:--:|:--:|:--:|:--:|------------------------------------------|
| /                      | GET    | +  | +  | -  | -  | Получить список лицензий                 |
| /                      | POST   | +  | +  | -  | -  | Создать новую лицензию                   |
| /{license_id}          | GET    | +  | +  | -  | -  | Получить данные лицензии                 |
| /{license_id}          | PATCH  | +  | +  | -  | -  | Обновить данные лицензии                 |
| /{license_id}          | DELETE | +  | +  | -  | -  | Удалить лицензию                         |

### Файл `src/api/v1/endpoints/tabit_management_companies.py`
Prefix: `/admin/companies`
| Эндпоинт                  | Метод  | TS | TA | CM | CU | Описание                              |
|---------------------------|:------:|:--:|:--:|:--:|:--:|---------------------------------------|
| /                         | GET    | +  | +  | -  | -  | Получить список всех компаний         |
| /                         | POST   | +  | +  | -  | -  | Создать новую компанию                |
| /{company_slug}           | PATCH  | +  | +  | -  | -  | Обновить данные компании              |
| /{company_slug}           | DELETE | +  | +  | -  | -  | Удалить компанию                      |

### Файл `src/api/v1/endpoints/tabit_admin_auth.py`
Prefix: `/admin/auth`
| Эндпоинт                  | Метод  | TS | TA | CM | CU | Описание                              |
|---------------------------|:------:|:--:|:--:|:--:|:--:|---------------------------------------|
| /                         | GET    | +  | -  | -  | -  | Получить список администраторов       |
| /{user_id}                | GET    | +  | -  | -  | -  | Получить карточку администратора      |
| /{user_id}                | PATCH  | +  | -  | -  | -  | Изменить данные администратора        |
| /{user_id}                | DELETE | +  | -  | -  | -  | Удалить администратора                |
| /me                       | GET    | +  | +  | -  | -  | Получить свою учетную запись          |
| /me                       | PATCH  | +  | +  | -  | -  | Обновить свои данные                  |
| /refresh-token            | POST   | +  | +  | -  | -  | Обновить токен                        |
| /                         | POST   | +  | -  | -  | -  | Создать администратора                |
| /login                    | POST   | +  | +  | -  | -  | Авторизация администратора            |
| /logout                   | POST   | +  | +  | -  | -  | Выход из системы                      |

### Файл `src/api/v1/endpoints/tasks.py`
Prefix: `/{company_slug}/problems/{problem_id}/tasks`
| Эндпоинт               | Метод  | TS | TA | CM | CU | Описание                                 |
|------------------------|:------:|:--:|:--:|:--:|:--:|------------------------------------------|
| /                      | GET    | +  | +  | +  | +  | Получить задачи проблемы                 |
| /                      | POST   | +  | +  | +  | +  | Создать задачу                           |
| /{task_id}             | GET    | +  | +  | +  | +  | Получить информацию о задаче             |
| /{task_id}             | PATCH  | +  | +  | +  | +  | Обновить задачу                          |
| /{task_id}             | DELETE | +  | +  | +  | +  | Удалить задачу                           |
