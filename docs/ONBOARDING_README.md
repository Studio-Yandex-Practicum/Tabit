# Онбординг-программа для нового разработчика

Для отображения документации в виде HTML-документа используйте [dillinger.io](https://dillinger.io/) или любой другой онлайн-редактор Markdown.

## О проекте Tabit

Подробное описание проекта можно найти в [README.md](../README.md).

## Основные ресурсы для командной работы

- **Общая информация**: [Общие сведения о проекте](https://app.pachca.com/chats/17645724?message=427153532)
- **Командный чат**: [Информация о каналах связи](https://app.pachca.com/chats/17645724)
- **GitHub репозиторий**: [URL репозитория](https://github.com/Studio-Yandex-Practicum/Tabit)
- **Архитектура проекта**: [Актуальная ERD диаграмма](https://app.erdlab.io/designer/schema/1736745715-tabit)
- **Backlog проекта**: [URL доски с задачами](https://github.com/orgs/Studio-Yandex-Practicum/projects/55/)
- **Трекер задач**: Kaiten [URL доски с задачами](https://irinastarodubtseva2897.kaiten.ru/documents/g/d6b1906e-cb6d-451b-9dcd-935442095752)

## Архитектура проекта

- **Бэкенд**: FastAPI приложение, предоставляющее REST API
- **База данных**: PostgreSQL, используется асинхронная работа через SQLAlchemy и Alembic
- **Система аутентификации**: JWT-токены, роли пользователей (компаний, сотрудников, администраторов)
- **Контейнеризация**: Docker используется для локальной разработки и деплоя
- **Оркестрация процессов**: Make-команды для основных операций с проектом

## Структура проекта

Основные директории проекта:

- `src/` - Исходный код приложения
- `alembic/` - [Файлы миграций базы данных](#миграции-и-alembic)
- `fake_data_factories/` - [Генераторы тестовых данных](#генераторы-тестовых-данных)
- `infra/` - [Инфраструктурные файлы](#инфраструктура-docker)
- `logs/` - [Файлы логов](#логирование)
- `pgadmin/` - [Конфигурация pgAdmin](#работа-с-pgadmin)
- `scripts/` - [Вспомогательные скрипты](#вспомогательные-скрипты)

## Конфигурационные файлы проекта

В корне проекта находятся важные конфигурационные файлы:

- [.env.example](../.env.example) - Пример файла конфигурации окружения:
  - Параметры подключения к базе данных
  - Данные первого суперпользователя
  - Настройки почтового сервера
  - Конфигурация pgAdmin
  - Настройки логирования

- [.pre-commit-config.yaml](../.pre-commit-config.yaml) - Конфигурация pre-commit хуков:
  - Проверки стандартными хуками (запрет коммитов в защищенные ветки, проверка YAML/TOML файлов)
  - Проверка и автоформатирование кода с помощью Ruff
  - Автоматический экспорт зависимостей из Poetry при изменении файлов

- [.ruff.toml](../.ruff.toml) - Настройки линтера Ruff:
  - Ограничение длины строки: 99 символов
  - Исключенные директории: `alembic`
  - Используемые правила: `E`, `F`, `I`
  - Настройки форматирования кода
  - Конфигурация сортировки импортов

- [alembic.ini](../alembic.ini) - Конфигурация миграций Alembic:
  - Настройки подключения к базе данных (через переменные окружения)
  - Путь к файлам миграций
  - Настройки логирования

- [pyproject.toml](../pyproject.toml) - Основной файл конфигурации Poetry:
  - Содержит метаданные проекта (имя, версия, описание)
  - Список авторов и контрибьюторов
  - Зависимости проекта (основные и для разработки)
  - Настройки сборки

- [pytest.ini](../pytest.ini) - Конфигурация pytest:
  - Параметры подключения к базе данных
  - Настройки логирования
  - Настройки тестирования

## Дополнительные возможности

- [Makefile](../Makefile) - Основные команды для работы с проектом
- [Tabit.postman_collection.json](../Tabit.postman_collection.json) - Коллекция Postman для тестирования API
- CI/CD (GitHub Actions, в разработке, возможно надо будет перенести в другой раздел документации):
  - [.github/workflows/build_and_test.yml](../.github/workflows/build_and_test.yml) - Конфигурация для CI
  - [.github/workflows/stage_deploy.yml](../.github/workflows/stage_deploy.yml) - Конфигурация для CD
  - [.github/workflows/ruff.yml](../.github/workflows/ruff.yml) - Конфигурация для Ruff

## Основные технологии

Подробное описание технологий, используемых в проекте, можно найти в [README.md](../README.md#poetry-инструмент-для-работы-с-виртуальным-окружением-и-сборки-пакетов).

Ключевые технологии согласно [pyproject.toml](../pyproject.toml):
- **FastAPI**: Веб-фреймворк для создания API
Официальная документация: [FastAPI](https://fastapi.tiangolo.com/)
- **SQLAlchemy**: ORM для работы с базой данных
Официальная документация: [SQLAlchemy](https://www.sqlalchemy.org/)
- **PostgreSQL**: Реляционная база данных
Официальная документация: [PostgreSQL](https://www.postgresql.org/)
- **Alembic**: Система миграций БД
Официальная документация: [Alembic](https://alembic.sqlalchemy.org/)
- **Pydantic**: Валидация данных
Официальная документация: [Pydantic](https://docs.pydantic.dev/)
- **FastAPI-Users**: Управление пользователями
Официальная документация: [FastAPI-Users](https://fastapi-users.github.io/fastapi-users/)
- **Loguru**: Система логирования
Официальная документация: [Loguru](https://loguru.readthedocs.io/en/stable/)
- **FastAPI-mail**: Отправка электронной почты
Официальная документация: [FastAPI-mail](https://github.com/sabuhish/fastapi-mail)
- **Для разработки**: Black, Ruff, pytest, Faker, factory-boy
Официальная документация: [Black](https://black.readthedocs.io/en/stable/)
Официальная документация: [Ruff](https://beta.ruff.rs/docs/configuration/)
Официальная документация: [pytest](https://docs.pytest.org/)
Официальная документация: [Faker](https://faker.readthedocs.io/en/stable/)
Официальная документация: [factory-boy](https://factoryboy.readthedocs.io/en/latest/)

## Настройка окружения

### Базовая настройка

Инструкции по установке и настройке окружения доступны в [README.md](../README.md).

Основные шаги:
1. Клонировать репозиторий
2. Установить Poetry
3. Настроить виртуальное окружение
4. Установить pre-commit хуки

### Конфигурация с помощью .env файла

Для работы с проектом необходимо создать файл `.env` в корне проекта на основе [.env.example](../.env.example).

Основные группы настроек:
- Параметры подключения к базе данных
- Данные первого суперпользователя
- Настройки почтового сервера
- Конфигурация pgAdmin
- Настройки логирования

## Миграции и Alembic

Проект использует Alembic для управления миграциями базы данных. Конфигурация находится в [alembic.ini](../alembic.ini).

### Структура директории [alembic/](../alembic/)
- `versions/` - Файлы миграций
- `env.py` - Конфигурация среды выполнения миграций
- `script.py.mako` - Шаблон для генерации файлов миграций

### Особенности конфигурации Alembic
- Настроено автоматическое именование файлов миграций, с использованием скрипта [`auto_migration_naming.py`](../scripts/auto_migration_naming.py).

### Работа с миграциями через Make-команды

Подробные команды для работы с миграциями описаны в [Makefile](../Makefile):
- `make init-migrations` - Создание начальной миграции
- `make auto-migration m='описание'` - Автогенерация миграции с описанием
- `make empty-migration m='название'` - Создание пустой миграции
- `make apply-migrations` - Применение всех миграций

## Генераторы тестовых данных

Директория [fake_data_factories/](../fake_data_factories/) содержит модули для генерации тестовых данных.

### Ключевые модули:
- `base_user_factory.py` - Базовые классы для генерации пользователей
- `company_factories.py` - Генерация тестовых компаний
- `company_user_factories.py` - Генерация пользователей компаний
- `department_factories.py` - Генерация отделов/департаментов
- `tabit_user_factories.py` - Генерация администраторов системы
- `fill_db.py` - Сценарий заполнения всей базы тестовыми данными

### Команды для заполнения БД тестовыми данными:
Команды описаны в [Makefile](../Makefile):
- `make fill-db` - Заполнение всей базы тестовыми данными
- `make fill-companies` - Создание тестовых компаний
- `make fill-company-users` - Добавление пользователей компаний
- `make fill-tabit-admin-users` - Добавление администраторов системы
- `make fill-company-departments` - Создание департаментов

## Инфраструктура (Docker)

Директория [infra/](../infra/) содержит конфигурационные файлы для контейнеризации и деплоя:

### Основные файлы:
- `docker-compose.local-db.yaml` - Конфигурация для локального запуска БД
- `docker-compose.local-with-pgadmin.yaml` - Конфигурация с pgAdmin
- `local/` - Файлы для локального окружения
- `stage/` - Файлы для стейджинг-окружения

Инструкции по работе с Docker доступны в [README.md](../README.md#запуск-контейнеров-локально-для-отладки-cicd).

## Логирование

Проект использует встроенную систему логирования, настраиваемую через переменные окружения.

### Директория logs/
Содержит записи логов приложения:
- `tabit.log` - Основной лог приложения
- `fake_db_data.log` - Логи заполнения тестовыми данными

### Использование логирования в коде:
```python
from src.logger import logger

# Различные уровни логирования
logger.info("Информационное сообщение")
logger.warning("Предупреждение")
logger.error("Ошибка")
```

Подробнее о логировании в [README.md](../README.md#логирование).

## Работа с pgAdmin

Для удобного администрирования базы данных используется pgAdmin через Docker.

### Директория pgadmin/
- `servers.json` - Предконфигурированное подключение к БД
- `config_local.py` - Конфигурация pgAdmin
- `create-admin-folder.sh` - Скрипт настройки внутри контейнера

### Запуск и доступ:
- Запуск: `make up-pgadmin`
- Доступ: http://localhost:5600
- Учетные данные из `.env`

Подробные инструкции в [README.md](../README.md#pgadmin).

## Вспомогательные скрипты

Директория [scripts/](../scripts/) содержит вспомогательные утилиты для разработки:

### Ключевые скрипты:
- `auto_migration_naming.py` - Автоматическое именование миграций
- `filling_data_manager.py` - Управление наполнением БД тестовыми данными

## Основные команды для работы с проектом

Все основные команды для работы с проектом описаны в [Makefile](../Makefile).

Ключевые категории команд:
- Управление контейнерами Docker
- Работа с миграциями БД
- Заполнение БД тестовыми данными
- Запуск приложения

## Стандарты кодирования и Workflow разработки

### Стандарты кодирования

Информация о стандартах кодирования доступна в [.ruff.toml](../.ruff.toml) и [.pre-commit-config.yaml](../.pre-commit-config.yaml):

- **Ограничения стиля**:
  - Длина строки: 99 символов
  - Используются одинарные кавычки для строк
  - Объединение импортов из одного места в одну строку

- **Правила проверки кода**:
  - E: Стилистические ошибки согласно PEP 8
  - F: Логические ошибки в коде
  - I: Проверки импортов

- **Pre-commit хуки**:
  - Запрет коммитов напрямую в защищенные ветки
  - Проверка YAML и TOML файлов
  - Добавление пустой строки в конце файла
  - Удаление лишних пробелов
  - Проверка расположения docstring
  - Проверка на конфликты в ветке
  - Проверка на наличие приватных ключей
  - Автоматическое форматирование кода с помощью Ruff
  - Автоматический экспорт зависимостей при изменении pyproject.toml или poetry.lock

### Git Flow и процесс работы

Информация о Git Flow и процессе создания Pull Request доступна в [README.md](../README.md#правила-работы-с-git-как-делать-коммиты-и-pull-request-ы).

Придерживайтесь следующих принципов:
- Следуйте стандартам кодирования и используйте типизацию
- Придерживайтесь Git Flow и именования веток
- Соблюдайте процесс создания и проверки PR

## Примеры кода и шаблоны (в разработке)

Примеры реализации типовых задач можно найти в соответствующих разделах кодовой базы:

- Создание нового эндпоинта

- Создание новой модели SQLAlchemy

- Создание нового сервиса

- Создание нового теста

- Шаблон докстринга

- Шаблон логирования

## Техническая документация

- **Поддержание актуальности документации**:
   - Документируйте изменения API
   - Обновляйте описания моделей данных
   - Следите за актуальностью файлов README и документации

- **Активные разделы разработки**:
  - Основные направления текущей итерации: (в разработке)
  - Критические компоненты, требующие внимания: (в разработке)

- **Текущие приоритеты разработки**:
  - Добавление функционала: (в разработке)
  - Исправление проблем: (в разработке)

- **Известные ограничения**:
  - Список известных технических долгов или ограничений: (в разработке)
  - Запланированные архитектурные изменения: (в разработке)

## Процесс обновления материалов

1. **Ответственность за документацию**:
   - Техлид несет ответственность за актуальность архитектурной документации
   - Тимлид несет ответственность за актуальность программы онбординга
   - Каждый разработчик несет ответственность за актуальность документации к компонентам, которые он изменяет
   - В конце спринта проводится ревью изменений документации

2. **Процесс внесения изменений**:
   - Изменения в документацию (отдельное изменения или вместе с кодом) вносятся через PR
   - Все изменения в API должны быть отражены в OpenAPI спецификации
   - Все изменения схемы БД должны быть задокументированы
   - Тег "documentation" для issues используется для улучшения документации

3. **Обратная связь по онбордингу**:
   - После первой недели работы дайте обратную связь по онбордингу
   - Предложения по улучшению онбординга приветствуются в любое время

## Стартовый набор квестов

Выполните эти задачи в течение первых дней работы:

1. **Квест 0: Изучение документации**
   - Изучите [README.md](../README.md)

2. **Квест 1: Настройка окружения**
   - Клонируйте репозиторий
   - Установите Poetry и зависимости проекта
   - Настройте pre-commit хуки
   - Создайте .env файл на основе .env.example
   - Изучите конфигурационные файлы:
   [pyproject.toml](../pyproject.toml),
   [alembic.ini](../alembic.ini),
   [.ruff.toml](../.ruff.toml),
   [.pre-commit-config.yaml](../.pre-commit-config.yaml)

3. **Квест 2: Изучение структуры проекта**
   - Ознакомьтесь с моделями данных [ERD диаграмма](https://app.erdlab.io/designer/schema/1736745715-tabit)
   - Изучите основные модули в директории `src`
   - Изучите миграции и структуру базы данных
   - Познакомьтесь с инфраструктурными файлами проекта

4. **Квест 3: Локальный запуск**
   - Запустите контейнеры с базой данных
   - Примените миграции
   - Создайте суперпользователя
   - Запустите приложение
   - Проверьте работу API в браузере (Swagger UI)

5. **Квест 4: Работа с тестовыми данными**
   - Изучите код генераторов в директории
   - Заполните базу тестовыми данными
   - Подключитесь к БД через pgAdmin или DBeaver
   - Убедитесь, что данные заполнились корректно
   - Выполните несколько запросов к базе данных

6. **Квест 5: Первое изменение**
   - Выберите задачу из [Backlog проекта](https://github.com/orgs/Studio-Yandex-Practicum/projects/55/)
   - Создайте ветку для новой функции
   - Внесите изменения в проект
   - Опционально:
     - Создайте или обновите тесты для новой функции
     - Создайте или обновите миграцию
     - Создайте или обновите документацию
   - Протестируйте изменения локально
   - Создайте Pull Request с описанием изменений
   - Убедитесь, что pre-commit хуки выполняются корректно
   - Дождитесь проверки PR
   - При наличии замечаний внесите правки в ветку
   - Дождитесь принятия PR и слияния в ветку `dev`
   - Дождитесь прохождения тестов CI/CD
   - При наличии ошибок в тестах (в разработке):
     - Проверьте логи
     - Исправьте ошибки
   - Дождитесь повторного прохождения тестов CI/CD
